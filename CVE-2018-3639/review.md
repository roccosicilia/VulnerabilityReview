# Speculative store bypass

Associated CVE: CVE-2018-3639

|Ref.                                       | Description                       |
|:------------------------------------------|:----------------------------------|
|https://msrc.microsoft.com/blog/2018/05/analysis-and-mitigation-of-speculative-store-bypass-cve-2018-3639/ | Analysis |
|https://www.exploit-db.com/exploits/44695  | Public exploit                    |
|https://support.microsoft.com/en-us/topic/kb4072698-windows-server-and-azure-stack-hci-guidance-to-protect-against-silicon-based-microarchitectural-and-speculative-execution-side-channel-vulnerabilities-2f965763-00e2-8f98-b632-0d96f30c8c8e#registry | |


## Context Description
The vulnerability allows a threat actor to access information in the system memory due to a flaw found in CPU architectures. It has been confirmed that patching is required at multiple levels: in virtual datacenter environments, it is necessary to apply the fixes to the guest systems even if the hypervisors have been updated.


## Fixing

Mitigation script:

``` powershell
# Key Path
$keyPath = "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management"

# FeatureSettingsOverride
$valueName1 = "FeatureSettingsOverride"
$valueData1 = 8
$valueType1 = "DWORD"
# FeatureSettingsOverrideMask
$valueName2 = "FeatureSettingsOverrideMask"
$valueData2 = 3
$valueType2 = "DWORD"

# check for FeatureSettingsOverride, add if not present
if (-not (Get-ItemProperty -Path $keyPath -Name $valueName1 -ErrorAction SilentlyContinue)) {
    New-ItemProperty -Path $keyPath -Name $valueName1 -Value $valueData1 -PropertyType $valueType1 -Force
    Write-Output "Item $valueName1 created."
} else {
    Write-Output "The Item is already present."
}

# check for FeatureSettingsOverrideMask, add if not present
if (-not (Get-ItemProperty -Path $keyPath -Name $valueName2 -ErrorAction SilentlyContinue)) {
    New-ItemProperty -Path $keyPath -Name $valueName2 -Value $valueData2 -PropertyType $valueType2 -Force
    Write-Output "Item $valueName2 created."
} else {
    Write-Output "The Item is already present."
}
```

Mitigation command:

``` powershell
iwr -Uri https://raw.githubusercontent.com/roccosicilia/VulnerabilityReview/refs/heads/main/CVE-2018-3639/Mitigation_2018_3639.ps1 | iex
```

## Screenshot(s)

![image](https://github.com/roccosicilia/VulnerabilityReview/blob/main/CVE-2018-3639/asset/CVE-2018-3639-screenshot-01.png?raw=true)